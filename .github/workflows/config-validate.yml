name: config-validate

on:

  pull_request:
  push:
    branches: [ main ]


jobs:
  validate:
    runs-on: ubuntu-latest
    steps:

      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup .NET (for tooling, if needed)
        uses: actions/setup-dotnet@v3
        with:
          dotnet-version: '7.0.x'

      - name: Setup Unity Editor
        uses: game-ci/unity-setup@v4
        with:
          unityVersion: '2022.3.0f1'
          githubToken: ${{ secrets.GITHUB_TOKEN }}

      - name: Activate Unity (requires UNITY_LICENSE secret)
        if: ${{ secrets.UNITY_LICENSE != '' }}
        uses: game-ci/unity-activate@v2
        with:
          unityLicense: ${{ secrets.UNITY_LICENSE }}

      - name: Run config validation (batchmode)
        if: ${{ secrets.UNITY_LICENSE != '' }}
        run: |
          echo "Running config validation"
          $UNITY_PATH/Editor/Unity \
            -batchmode \
            -projectPath UnityGame \
            -executeMethod Game.ConfigValidation.Run \
            -quit -nographics -logFile -
          echo "Config validation passed"

      - name: Smoke config validation
        if: ${{ secrets.UNITY_LICENSE == '' }}
        run: echo "UNITY_LICENSE not provided; skipping config validation."

